name: Dry-Run

on:
  pull_request:
    branches: [ $default-branch ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'yarn'

    - name: Install deps
      run: yarn --frozen-lockfile
      env:
        GRAPHHOPER_API_KEY: ${{ secrets.GRAPHHOPER_API_KEY }}
        OPENROUTESERVICE_API_KEY: ${{ secrets.OPENROUTESERVICE_API_KEY }}
        GEOAPIFY_API_KEY: ${{ secrets.GEOAPIFY_API_KEY }}
        THUNDERFOREST_API_KEY: ${{ secrets.THUNDERFOREST_API_KEY }}
        MAPTILER_API_KEY: ${{ secrets.MAPTILER_API_KEY }}

    - name: Lint
      run: yarn lint

    - name: Build
      run: yarn build:server --if-present
      run: yarn build:client --if-present
